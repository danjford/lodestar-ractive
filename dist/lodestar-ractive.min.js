!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.LodeRactive=t()}(this,function(){"use strict";function e(t,n,i){for(var r=0,a=n.length;a>r;r++){var s=n[r];if(!o(s))return;for(var c=Object.keys(s),l=0,u=c.length;u>l;l++){var h=c[l],f=s[h];o(f)&&i?(o(t[h])||(t[h]=Array.isArray(f)?[]:{}),e(t[h],[f],!0)):t[h]=f}}return t}function t(t,n){return e(t,[n],!1)}function n(t,n){return e(t,[n],!0)}function o(e){return null!==e&&"object"==typeof e}function i(e){e.routes={},e.config=t({},k),window.LodeVar=window.LodeVar||{}}function r(t,o){return o&&("undefined"!=typeof o.DEBUG&&(T=n({},{DEBUG:o.DEBUG})),delete o.DEBUG,o.loggingLevel&&(o.loggingLevel=o.loggingLevel.toUpperCase()),t.config=e({},[t.config,o],!0)),t.config}function a(){U&&T.DEBUG&&(console[B?"groupCollapsed":"log"].apply(console,A),console.log(j),B&&console.groupEnd(A))}function s(e,t){P.warn("Route "+e+" of "+t+" not found.")}function c(e,t){for(var n=Object.getOwnPropertyNames(t),o=0,i=n.length;i>o;o++)n[o]!==e&&(t[n[o]].active=!1,t[n[o]].childRoutes&&c(!1,t[n[o]].childRoutes))}function l(e,t){var n={};t.shift();for(var o=0,i=t.length;i>o;o++)n[t[o].replace(/\//g,"")]=e.match(/[^\/]*/g)[0!==o?o+o:o];return n}function u(e,t){"undefined"!=typeof this.userNotFound&&this.userNotFound(),s(e,t)}function h(e){if(""===e&&(e="/"),e)for(var t=this.routes,n=e,o=!1,i="",r=!1;e.length;){var a={};for(var s in t){var h=!1;if(i=s,s.indexOf(":")>-1){var f=s.split(":");f.length>2?(a=l(e,f),h=s.replace(/\:[^\/]*/g,"[^\\/]*")):(a[s.replace(":","")]=e.match(/[^\/]*/)[0],h=/[^\/]*/)}if(s.match(/\*[a-z]+/i)&&(a[s.replace(/\*[a-z]+/i,"")]=e.match(/.*/)[0].split("/"),h=/.*/),r=e.match("^"+(h||s)),o=r&&0===e.replace(r[0],"").replace(/^\//,"").replace(/\/$/,"").length?!0:!1,e.length&&r){t[s].active||o||(t[s].routeData=a,t[s].active=!0,t[s].controller()),e=e.replace(r[0],"").replace(/^\//,"").replace(/\/$/,""),t[s]&&c(s,t),t[s].childRoutes&&!o?t=t[s].childRoutes:o||(u.call(this,e,n),e="");break}}if(o)t[i].routeData=a,t[i].active=!0,t[i].controller();else if(!r){u.call(this,e,n),e="";break}}}function f(e,t){for(var n=this.routes,o={};e.length;)for(var i in n){var r=e.match("^"+i);if(e.length&&r){e=e.replace(r[0],"").replace(/^\//,"").replace(/\/$/,""),o=n[i],n=n[i].childRoutes||n[i];break}}"undefined"==typeof o.childRoutes&&(o.childRoutes={}),t.path=t.path.substring(t.path.indexOf("]")+1).replace(/^\//,"").replace(/\/$/,""),o.childRoutes[t.path]={},o.childRoutes[t.path].controller=t.controller}function d(){return n({},this.routes)}function p(e){return""===e&&(e="/"),e=e.replace(/^(\/?[\#\!\?]+)/,"").replace(/$\//,""),this.config.basePath.length&&(e=e.replace(this.config.basePath,"")),e}function g(e){var t=e.indexOf("[")+1,n=e.indexOf("]");return e.substring(t,n)}function w(e){return window.location.origin?e.replace(window.location.origin,""):e.replace(window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),"")}function v(e){for(;e;){if(e instanceof HTMLAnchorElement)return e;e=e.parentNode}return!1}function m(e){e=window.e||e;var t=e.target,n="",o="",i="";return"A"!==t.tagName&&(t=v(t)),!t||(n=t.getAttribute("href"),"_blank"===n||n.indexOf(":")>-1&&!n.match(/(?:https?):/)||n.match(/(?:https?):/)&&-1===n.indexOf(window.location.hostname))?void 0:(i=w(n),o=p.call(this,i),history.pushState(null,null,i),e.preventDefault(),""===o?"/":o)}function b(){var e=this;if(!this.config.listenerActive){"HIGH"===this.config.loggingLevel&&P.debug("Listener is now active.");var t=O?window.addEventListener:window.attachEvent,n=O?document.addEventListener:document.attachEvent,o=this.config.useHistory&&M?window.location.pathname:window.location.hash;this.config.listenerActive=!0,n("click",function(t){window.LodeVar.previousPath=p.call(e,w(window.location.href))}),this.config.useHistory&&M?this.config.useHistory&&M&&("HIGH"===this.config.loggingLevel&&P.debug("Listening for clicks or popstate."),n("click",function(t){var n=m.call(e,t);n&&e.resolve(n)}),t("popstate",function(){e.resolve(p.call(e,window.location.pathname))})):("HIGH"===this.config.loggingLevel&&P.debug("Listening for hash changes."),t(O?"hashchange":"onhashchange",function(){e.resolve(p.call(e,window.location.hash))})),this.resolve(p.call(this,o))}}function y(e){if(this.config.usingMap===!1)throw new Error("Do not use map() as well as createRoute().");for(var t in e)this.routes[t]=e[t];this.config.usingMap=!0,b.call(this)}function E(e){var t=this;if(this.config.usingMap===!0)throw new Error("Do not use createRoute() as well as map().");if(!e)throw new Error("No route object defined.");if(!e.path)throw new Error("Please define the route to use.");if(!e.controller||"function"!=typeof e.controller)throw new Error("Please define the function that should be executed.");var n="";e.path.indexOf("[")>-1?(n=g(e.path),f.call(this,n,e)):(e.path=p.call(this,e.path),this.routes[e.path]={},this.routes[e.path].controller=e.controller),""===this.config.usingMap&&setTimeout(function(){b.call(t)},0),this.config.usingMap=!1}function L(e){i(this),r(this,e),a()}function R(e,t){var n=t.container?t.container:"body",o=new RegExp("(<[s/]*script\\b[^>]*>)([^>]*)(</script>)","gi");return e.querySelector(n).innerHTML.replace(o,"")}function D(e){return new F(function(t,n){var o=void 0;o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o.onreadystatechange=function(){var i=[404,400,500];4===o.readyState&&200===o.status?t(R(o.responseXML,e)):i.indexOf(o.status)>-1&&n({status:this.status,statusText:o.statusText})},o.onerror=function(e){n({status:this.status,statusText:o.statusText})},o.open("GET",e.url),o.responseType="document",o.send()})}function G(e){var t=new Ractive(e.view);for(var n in t)t.hasOwnProperty(n)&&"data"!==n&&(this[n]=t[n]);for(var o=0,i=N.length;i>o;o++)"undefined"!=typeof t[N[o]]&&(this[[N[o]]]=t[N[o]]);e.actions&&t.on(e.actions),e.observe&&t.observe(e.observe),this.on=function(){throw new Error("Use the actions attribute in the route object.")},this.observe=function(){new Error("Use the observe attribute in the route object.")},e.controller.call(this,this.routeData||{})}function x(e){var t=this;if(e.view&&!e.active)if(o(e.view.template)&&e.view.template.url){if(e.view.template.notOnSame&&e.view.template.url===(window.LodeVar.previousPath||e.view.template.url))return e.view.template=R(document.getElementsByTagName("body")[0],e.view.template),void G.call(this,e);D(e.view.template).then(function(n){e.view.template=n,G.call(t,e)})}else G.call(this,e)}function H(e){if("undefined"==typeof Ractive)throw Error("Couldn't find an instance of Ractive, you need to have it in order to use this framework.");e&&"undefined"!=typeof e.DEBUG&&(Ractive.DEBUG=e.DEBUG),this.router=new L(e)}var U="undefined"!=typeof console,B=!!console.groupCollapsed,M=!(!window.history||!history.pushState),O=!!window.addEventListener,T={DEBUG:!0},k={useHistory:!1,basePath:"",loggingLevel:"LOW",usingMap:"",listenerActive:!1},P={};P.debug=function(){U&&T.DEBUG&&console.debug.apply(console,arguments)},P.log=function(){U&&T.DEBUG&&console.log.apply(console,arguments)},P.warn=function(){U&&T.DEBUG&&console.warn.apply(console,arguments)};var A=["LodestarJs-Router 1.0.3 in debug mode."],j="\n\nHello, you are running the LodestarJs Router 1.0.3 in debug mode.\nThis will help you to identify any problems in your application.\n\nDEBUG mode is a global option, to disable debug mode will disable it for each\ninstance. You can disable it when declaring a new instance. For example,\nnew Router({DEBUG: false});\n\nFor documentation head to the wiki:\n  https://github.com/lodestarjs/lodestar-router/wiki\n\nIf you have found any bugs, create an issue for us:\n  https://github.com/lodestarjs/lodestar-router/issues\n\n";L.prototype={createRoute:E,map:y,getRoutes:d,resolve:h,notFound:function(e){this.userNotFound=e}};var F=F||Ractive.Promise,N=["add","animate","detach","find","findAll","findAllComponents","findComponent","findContainer","findParent","fire","get","insert","link","merge","off","pop","push","render","reset","resetPartial","resetTemplate","reverse","set","shift","sort","splice","subtract","teardown","toggle","toHTML","unlink","unrender","unshift","update","updateModel"];return H.prototype={createRoute:function(e){this.router.createRoute({path:e.path,controller:function(t){x.call(this,e)}})},notFound:function(e){this.router.notFound(e)}},H});
//# sourceMappingURL=lodestar-ractive.min.js.map
